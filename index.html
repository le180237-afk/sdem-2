<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuy·ªÉn ƒê·ªïi S·ªë sang Ti·∫øng Nh·∫≠t (0 - 9,999,999)</title>
    <meta name="theme-color" content="#6366F1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* C·∫•u h√¨nh chung & Matrix */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        #matrix-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.15;
        }

        .header-flags {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 4px solid #005A9C;
            margin-top: 10px;
        }

        .flag {
            width: 60px;
            height: auto;
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            transition: transform 0.3s;
        }

        .app-title {
            color: #005A9C;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            font-weight: 900;
        }

        .app-container {
            position: relative;
            z-index: 2;
            background-color: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
            width: 90%;
            max-width: 450px;
        }

        .input-field {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-field:focus {
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.4);
        }

        /* T√πy ch·ªânh Khu v·ª±c K·∫øt qu·∫£ */
        #resultBox {
            background: linear-gradient(135deg, #eef2ff 0%, #f6f7ff 100%);
            border: 1px solid #c3dafe;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transition: all 0.5s ease-in-out;
            transform: translateY(0);
        }

        .result-text {
            font-family: 'Inter', sans-serif;
            font-size: 38px;
            font-weight: 900;
            color: #4f46e5;
            text-align: center;
            padding: 10px 0;
            text-shadow: 0 0 2px rgba(79, 70, 229, 0.5), 0 0 10px rgba(79, 70, 229, 0.2);
            word-break: break-all;
            line-height: 1.2;
        }

        /* Hi·ªáu ·ª©ng tr∆∞·ª£t l√™n khi c√≥ k·∫øt qu·∫£ */
        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #resultBox:not(.hidden) {
            animation: fadeInSlideUp 0.5s ease-out;
        }

        /* CSS cho c·ªù */
        .flag-placeholder {
            width: 60px;
            height: 40px;
            border: 3px solid #fff;
            border-radius: 8px;
            background-color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-indigo': '#6366F1',
                        'text-dark': '#1f2937',
                        'text-light': '#4b5563',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="flex flex-col items-center p-4">

    <canvas id="matrix-background"></canvas>

    <div class="header-flags">
        <img src="https://flagcdn.com/w80/vn.png" alt="C·ªù Vi·ªát Nam" class="flag vietnam">
        <h1 class="app-title">üáØüáµ S·ªë ƒê·∫øm Nh·∫≠t B·∫£n üáªüá≥</h1>
        <img src="https://flagcdn.com/w80/jp.png" alt="C·ªù Nh·∫≠t B·∫£n" class="flag japan">
    </div>

    <div class="it-e6-info text-center mt-3 text-red-700 font-bold bg-white p-2 rounded-lg shadow-md max-w-sm">
        Ch∆∞∆°ng tr√¨nh IT-E6 - ƒêH B√°ch Khoa H√† N·ªôi
    </div>

    <div class="app-container">
        <div id="app-content-wrapper" class="w-full mb-8">

            <div class="mb-6 bg-gray-50 p-4 rounded-xl border border-gray-200">
                <p class="text-xl font-bold text-primary-indigo mb-3 flex items-center">
                    <i class="fas fa-sliders-h mr-2"></i>T√πy Ch·ªânh Gi·ªçng ƒê·ªçc
                </p>

                <div class="mb-4">
                    <label for="voiceSelect" class="block text-lg font-semibold text-text-dark mb-2">
                        <i class="fas fa-microphone-alt mr-2 text-indigo-500"></i>Gi·ªçng ƒê·ªçc:
                    </label>
                    <select id="voiceSelect" class="input-field w-full text-base text-text-dark">
                        <option value="-1">ƒêang t·∫£i gi·ªçng ƒë·ªçc...</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="rateInput"
                        class="block text-lg font-semibold text-text-dark mb-2 flex justify-between items-center">
                        <span><i class="fas fa-tachometer-alt mr-2 text-indigo-500"></i>T·ªëc ƒê·ªô:</span>
                        <span id="rateValue" class="text-text-light font-normal">0.9</span>
                    </label>
                    <input type="range" id="rateInput" min="0.1" max="2.0" step="0.1" value="0.9"
                        class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer range-lg">
                </div>

                <div class="mb-2">
                    <label for="pitchInput"
                        class="block text-lg font-semibold text-text-dark mb-2 flex justify-between items-center">
                        <span><i class="fas fa-wave-square mr-2 text-indigo-500"></i>Cao ƒê·ªô (Pitch):</span>
                        <span id="pitchValue" class="text-text-light font-normal">1.0</span>
                    </label>
                    <input type="range" id="pitchInput" min="0" max="2" step="0.1" value="1.0"
                        class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer range-lg">
                </div>
            </div>


            <div class="space-y-5 mb-8">
                <label for="numberInput" class="block text-lg font-semibold text-text-dark">
                    <i class="fas fa-hashtag mr-2 text-primary-indigo"></i>Nh·∫≠p S·ªë (0 - 9,999,999):
                </label>
                <input type="number" id="numberInput" placeholder="V√≠ d·ª•: 10000, 350000, 9999999"
                    class="input-field w-full text-lg text-text-dark" min="0" max="9999999">

                <button id="convertButton"
                    class="bg-primary-indigo hover:bg-indigo-600 w-full text-white py-3 rounded-xl font-bold text-xl tracking-wide transition transform hover:scale-[1.01] duration-200">
                    <i class="fas fa-arrow-right mr-2"></i>Chuy·ªÉn ƒê·ªïi Ngay
                </button>
            </div>


            <div id="resultBox" class="p-6 mt-6 hidden result-box space-y-4">

                <div class="border-b pb-4 border-gray-200">
                    <div class="flex justify-between items-start mb-3">
                        <p class="text-lg text-text-dark font-medium flex items-center">
                            <i class="fas fa-spell-check mr-2 text-primary-indigo"></i>Romaji:
                        </p>
                        <div class="flex space-x-2">
                            <button id="speakerButton"
                                class="bg-pink-500 text-white text-sm font-semibold px-3 py-1 rounded-full shadow-md hover:bg-pink-600 flex items-center transition">
                                <i class="fas fa-volume-up mr-1" id="speakerIcon"></i>
                                <span id="speakerText">ƒê·ªçc</span>
                            </button>
                            <button id="copyRomajiButton"
                                class="bg-blue-500 text-white text-sm font-semibold px-3 py-1 rounded-full shadow-md hover:bg-blue-600 flex items-center transition"
                                title="Sao ch√©p Romaji">
                                <i class="fas fa-copy mr-1"></i>Sao ch√©p
                            </button>
                        </div>
                    </div>
                    <div id="romajiOutput" class="result-text text-text-dark text-2xl md:text-3xl lg:text-3xl"></div>
                </div>

                <div class="border-b pb-4 border-gray-200">
                    <p class="text-lg text-text-dark font-medium mb-3 flex items-center">
                        <i class="fas fa-feather-alt mr-2 text-pink-500"></i>Hiragana:
                    </p>
                    <div id="hiraganaOutput" class="text-3xl font-bold text-gray-800 text-center"></div>
                </div>

                <div>
                    <p class="text-lg text-text-dark font-medium mb-3 flex items-center">
                        <i class="fas fa-paint-brush mr-2 text-red-500"></i>Kanji:
                    </p>
                    <div id="kanjiOutput" class="text-4xl font-extrabold text-red-600 text-center"></div>
                </div>
            </div>

            <div id="messageBox" class="mt-4 p-4 text-sm hidden" role="alert">
                <p id="messageText" class="flex items-center">
                    <i class="fas mr-2"></i>
                    <span></span>
                </p>
            </div>

        </div>
    </div>
    
    <footer class="text-center mt-6 text-text-light text-sm p-4 w-full max-w-lg">
        <p class="font-bold text-text-dark mb-1">ƒêH B√°ch Khoa H√† N·ªôi</p>
        <p>Ph√°t tri·ªÉn: L·ª£i L√™ IT E6</p>
    </footer>

    <script>
        // --- JAVASCRIPT: LOGIC MATRIX RAIN (Hi·ªáu ·ª©ng n·ªÅn) ---
        const canvas = document.getElementById('matrix-background');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            columns = Math.floor(width / fontSize);
            drops = Array(columns).fill(1);
        });
        const katakana = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„Éî„Ç¶„Ç•„ÇØ' +
            '„Çπ„ÉÑ„Éå„Éï„É†„É¶„É´„Ç∞„Ç∫„Éñ„Éó„Ç®„Çß„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„É±„Ç≤„Çº„Éá„Éô„Éö„Ç™„Ç©„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„É≠„É≤„Ç¥„Çæ„Éâ„Éú„Éù„É¥„ÉÉ„É≥0123456789';
        const characters = katakana.split('');
        const fontSize = 16;
        let columns = Math.floor(width / fontSize);
        let drops = Array(columns).fill(1);
        function draw() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.02)';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#00ff41'; // M√†u xanh l√° neon
            ctx.font = `${fontSize}px monospace`;
            for (let i = 0; i < drops.length; i++) {
                const text = characters[Math.floor(Math.random() * characters.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(draw, 33);
        // --- K·∫æT TH√öC LOGIC MATRIX RAIN ---


        // --- JAVASCRIPT: LOGIC ·ª®NG D·ª§NG ---
        let isSpeaking = false;
        const MAX_NUMBER_LIMIT = 9999999;
        let voices = [];
        let selectedVoiceIndex = -1;

        // B·∫£ng √°nh x·∫° Romaji v√† S·ªë ƒë∆°n
        const ichikyuu = ["rei", "ichi", "ni", "san", "yon", "go", "roku", "nana", "hachi", "kyuu"];
        const unit_hyaku = "hyaku";
        const unit_juu = "juu";
        const unit_sen = "sen";
        const unit_man = "man";

        // B·∫£ng √°nh x·∫° Romaji -> Hiragana/Kanji
        const romajiToHiraganaMap = {
            'a': '„ÅÇ', 'i': '„ÅÑ', 'u': '„ÅÜ', 'e': '„Åà', 'o': '„Åä', 'ka': '„Åã', 'ki': '„Åç', 'ku': '„Åè', 'ke': '„Åë', 'ko': '„Åì',
            'sa': '„Åï', 'shi': '„Åó', 'su': '„Åô', 'se': '„Åõ', 'so': '„Åù', 'ta': '„Åü', 'chi': '„Å°', 'tsu': '„Å§', 'te': '„Å¶', 'to': '„Å®',
            'na': '„Å™', 'ni': '„Å´', 'nu': '„Å¨', 'ne': '„Å≠', 'no': '„ÅÆ', 'ha': '„ÅØ', 'hi': '„Å≤', 'fu': '„Åµ', 'he': '„Å∏', 'ho': '„Åª',
            'ma': '„Åæ', 'mi': '„Åø', 'mu': '„ÇÄ', 'me': '„ÇÅ', 'mo': '„ÇÇ', 'ya': '„ÇÑ', 'yu': '„ÇÜ', 'yo': '„Çà', 'ra': '„Çâ', 'ri': '„Çä',
            'ru': '„Çã', 're': '„Çå', 'ro': '„Çç', 'wa': '„Çè', 'wo': '„Çí', 'n': '„Çì', 'ga': '„Åå', 'gi': '„Åé', 'gu': '„Åê', 'ge': '„Åí',
            'go': '„Åî', 'za': '„Åñ', 'ji': '„Åò', 'zu': '„Åö', 'ze': '„Åû', 'da': '„Å†', 'de': '„Åß', 'do': '„Å©', 'ba': '„Å∞', 'bi': '„Å≥',
            'bu': '„Å∂', 'be': '„Åπ', 'bo': '„Åº', 'pa': '„Å±', 'pi': '„Å¥', 'pu': '„Å∑', 'pe': '„Å∫', 'po': '„ÅΩ',
            'sanbyaku': '„Åï„Çì„Å≥„ÇÉ„Åè', 'roppyaku': '„Çç„Å£„Å¥„ÇÉ„Åè', 'happyaku': '„ÅØ„Å£„Å¥„ÇÉ„Åè', 'sanzen': '„Åï„Çì„Åú„Çì',
            'hassen': '„ÅØ„Å£„Åõ„Çì', 'juu': '„Åò„ÇÖ„ÅÜ', 'hyaku': '„Å≤„ÇÉ„Åè', 'sen': '„Åõ„Çì', 'man': '„Åæ„Çì', 'rei': '„Çå„ÅÑ',
            'ichi': '„ÅÑ„Å°', 'ni': '„Å´', 'san': '„Åï„Çì', 'yon': '„Çà„Çì', 'go': '„Åî', 'roku': '„Çç„Åè', 'nana': '„Å™„Å™',
            'hachi': '„ÅØ„Å°', 'kyuu': '„Åç„ÇÖ„ÅÜ', 'ichiman': '„ÅÑ„Å°„Åæ„Çì',
        };

        const romajiToKanjiMap = {
            'rei': 'Èõ∂', 'ichi': '‰∏Ä', 'ni': '‰∫å', 'san': '‰∏â', 'yon': 'Âõõ', 'go': '‰∫î', 'roku': 'ÂÖ≠', 'nana': '‰∏É',
            'hachi': 'ÂÖ´', 'kyuu': '‰πù', 'juu': 'ÂçÅ', 'hyaku': 'Áôæ', 'sen': 'ÂçÉ', 'man': '‰∏á',
            'sanbyaku': '‰∏âÁôæ', 'roppyaku': 'ÂÖ≠Áôæ', 'happyaku': 'ÂÖ´Áôæ', 'sanzen': '‰∏âÂçÉ', 'hassen': 'ÂÖ´ÂçÉ',
            'ichiman': '‰∏Ä‰∏á',
        };

        // H√†m chuy·ªÉn Romaji sang Hiragana
        function romajiToKana(romaji) {
            const words = romaji.split(/\s+/).filter(word => word.length > 0);
            let hiragana = '';
            for (const word of words) {
                hiragana += romajiToHiraganaMap[word] || `(${word})`;
            }
            return hiragana;
        }

        // H√†m chuy·ªÉn Romaji sang Kanji (c·∫ßn logic ph·ª©c t·∫°p h∆°n)
        function romajiToKanji(romaji) {
            const words = romaji.split(/\s+/).filter(word => word.length > 0);
            let kanji = '';
            for (let i = 0; i < words.length; i++) {
                const word = words[i];
                const mappedKanji = romajiToKanjiMap[word];

                if (mappedKanji) {
                    // X·ª≠ l√Ω ƒë∆°n v·ªã: ÂçÅ, Áôæ, ÂçÉ
                    if (word === 'juu' || word === 'hyaku' || word === 'sen') {
                        // N·∫øu t·ª´ tr∆∞·ªõc ƒë√≥ kh√¥ng ph·∫£i l√† m·ªôt s·ªë (t·ª©c l√† 10, 100, 1000)
                        // Trong logic Romaji, "ichi juu" ƒë√£ b·ªã l∆∞·ª£c b·ªè th√†nh "juu"
                        if (i === 0 || !['ichi', 'ni', 'san', 'yon', 'go', 'roku', 'nana', 'hachi', 'kyuu'].includes(words[i - 1])) {
                            kanji += mappedKanji;
                        } else {
                            // S·ªë ƒëi tr∆∞·ªõc: ƒë√£ x·ª≠ l√Ω trong logic convertNumberToRomaji
                            // Kh√¥ng c·∫ßn l√†m g√¨ th√™m, ch·ªâ in ra s·ªë (ƒë√£ l√†m ·ªü b∆∞·ªõc tr∆∞·ªõc) v√† ƒë∆°n v·ªã (sau)
                            kanji += mappedKanji;
                        }
                    }
                    // Tr∆∞·ªùng h·ª£p ichiman: 10,000
                    else if (word === 'ichiman') {
                        kanji += '‰∏Ä‰∏á';
                    }
                    // Tr∆∞·ªùng h·ª£p s·ªë ƒëi tr∆∞·ªõc ƒë∆°n v·ªã (ƒë√£ x·ª≠ l√Ω bi·∫øn √¢m: sanbyaku, hassen)
                    else if (['sanbyaku', 'roppyaku', 'happyaku', 'sanzen', 'hassen'].includes(word)) {
                        kanji += mappedKanji;
                    }
                    // C√°c s·ªë ƒë·∫øm ƒë∆°n l·∫ª (ichi, ni, san...)
                    else {
                        kanji += mappedKanji;
                    }

                } else {
                    // B·ªè qua c√°c t·ª´ kh√¥ng c√≥ trong map (th∆∞·ªùng l√† l·ªói)
                    // kanji += `(${word})`;
                }
            }
            return kanji;
        }


        // Logic chuy·ªÉn ƒë·ªïi s·ªë 3 ch·ªØ s·ªë (1 - 999)
        function convertThreeDigits(number) {
            if (number === 0) return "";
            let parts = [];
            const h = Math.floor(number / 100);
            const j = Math.floor((number % 100) / 10);
            const d = number % 10;

            if (h > 0) {
                let reading;
                if (h === 3) reading = "sanbyaku";
                else if (h === 6) reading = "roppyaku";
                else if (h === 8) reading = "happyaku";
                else if (h === 1) reading = unit_hyaku; // 100 l√† hyaku
                else reading = ichikyuu[h] + unit_hyaku;
                parts.push(reading);
            }
            if (j > 0) {
                let reading = (j === 1) ? unit_juu : ichikyuu[j] + unit_juu; // 10 l√† juu
                parts.push(reading);
            }
            if (d > 0) {
                parts.push(ichikyuu[d]);
            }
            return parts.join(" ");
        }

        // Logic chuy·ªÉn ƒë·ªïi s·ªë 4 ch·ªØ s·ªë (1 - 9999)
        function convertFourDigits(number) {
            if (number === 0) return "";
            const sen = Math.floor(number / 1000);
            const remainder = number % 1000;
            let parts = [];

            if (sen > 0) {
                let reading;
                if (sen === 3) reading = "sanzen";
                else if (sen === 8) reading = "hassen";
                else if (sen === 1) reading = unit_sen; // 1000 l√† sen
                else reading = ichikyuu[sen] + unit_sen;
                parts.push(reading);
            }

            const remainderReading = convertThreeDigits(remainder);
            if (remainderReading) {
                parts.push(remainderReading);
            }
            return parts.join(" ");
        }

        // Logic chuy·ªÉn ƒë·ªïi s·ªë ch√≠nh (0 - 9,999,999)
        function convertNumberToRomaji(number) {
            number = parseInt(number, 10);
            if (number === 0) return ichikyuu[0];

            const manPart = Math.floor(number / 10000);
            const unitPart = number % 10000;
            let parts = [];

            if (manPart > 0) {
                let manReading;
                if (manPart === 1) {
                    manReading = "ichiman";
                } else {
                    let baseReading = convertFourDigits(manPart);
                    manReading = baseReading + " " + unit_man;
                }
                parts.push(manReading);
            }

            if (unitPart > 0) {
                const unitReading = convertFourDigits(unitPart);
                if (unitReading) {
                    parts.push(unitReading);
                }
            }

            let result = parts.join(" ").trim();

            // S·ª≠a c√°c tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát do logic chung g√¢y ra kho·∫£ng tr·∫Øng kh√¥ng c·∫ßn thi·∫øt (vd: ichi man -> ichiman)
            result = result.replace(/ichi man/g, "ichiman");
            result = result.replace(/ichi sen/g, unit_sen);
            result = result.replace(/ichi hyaku/g, unit_hyaku);

            return result;
        }


        // --- LOGIC GI·ªåNG ƒê·ªåC (TTS) ---

        function populateVoiceList() {
            if (!('speechSynthesis' in window)) return;
            voices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';

            let jaVoicesFound = 0;
            let firstJaVoiceIndex = -1;

            for (let i = 0; i < voices.length; i++) {
                if (voices[i].lang.startsWith('ja')) {
                    const option = document.createElement('option');
                    option.textContent = voices[i].name + ' (' + voices[i].lang + ')';
                    option.value = i;
                    voiceSelect.appendChild(option);
                    jaVoicesFound++;
                    if (firstJaVoiceIndex === -1) {
                        firstJaVoiceIndex = i;
                    }
                }
            }

            if (jaVoicesFound > 0) {
                selectedVoiceIndex = firstJaVoiceIndex;
                voiceSelect.value = firstJaVoiceIndex;
                voiceSelect.disabled = false;
            } else {
                const option = document.createElement('option');
                option.textContent = 'Kh√¥ng t√¨m th·∫•y gi·ªçng Nh·∫≠t B·∫£n (ja-JP)';
                option.value = -1;
                voiceSelect.appendChild(option);
                voiceSelect.disabled = true;
                selectedVoiceIndex = -1;
                showMessage("C·∫£nh b√°o: Kh√¥ng t√¨m th·∫•y gi·ªçng ƒë·ªçc ja-JP. Gi·ªçng m·∫∑c ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng.", true);
            }
        }

        async function speakRomaji() {
            if (!('speechSynthesis' in window)) {
                showMessage("L·ªói: Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ Web Speech API.", true);
                return;
            }

            const romajiText = document.getElementById('romajiOutput').textContent.trim();
            const speakerButton = document.getElementById('speakerButton');
            const speakerIcon = document.getElementById('speakerIcon');
            const speakerText = document.getElementById('speakerText');

            if (!romajiText) {
                showMessage("Kh√¥ng c√≥ Romaji ƒë·ªÉ ƒë·ªçc.", true);
                return;
            }

            if (isSpeaking) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                speakerIcon.className = 'fas fa-volume-up mr-1';
                speakerText.textContent = 'ƒê·ªçc';
                return;
            }

            if (voices.length === 0) {
                populateVoiceList();
            }

            isSpeaking = true;
            speakerIcon.className = 'fas fa-spinner fa-spin mr-1';
            speakerText.textContent = 'ƒêang ph√°t...';
            document.getElementById('messageBox').classList.add('hidden');

            try {
                const utterance = new SpeechSynthesisUtterance(romajiText);
                utterance.rate = parseFloat(document.getElementById('rateInput').value);
                utterance.pitch = parseFloat(document.getElementById('pitchInput').value);

                if (selectedVoiceIndex !== -1 && voices.length > selectedVoiceIndex) {
                    const voice = voices[selectedVoiceIndex];
                    utterance.voice = voice;
                    utterance.lang = voice.lang;
                } else {
                    utterance.lang = 'ja-JP';
                }

                utterance.onend = () => {
                    isSpeaking = false;
                    speakerIcon.className = 'fas fa-volume-up mr-1';
                    speakerText.textContent = 'ƒê·ªçc';
                };

                utterance.onerror = (event) => {
                    console.error('L·ªói ƒë·ªçc:', event.error);
                    showMessage(`L·ªói ph√°t √¢m: ${event.error}.`, true);
                    isSpeaking = false;
                    speakerIcon.className = 'fas fa-volume-up mr-1';
                    speakerText.textContent = 'ƒê·ªçc';
                };

                window.speechSynthesis.speak(utterance);
            } catch (err) {
                console.error('L·ªói ƒë·ªçc:', err);
                showMessage("Kh√¥ng th·ªÉ ph√°t √¢m thanh.", true);
                isSpeaking = false;
                speakerIcon.className = 'fas fa-volume-up mr-1';
                speakerText.textContent = 'ƒê·ªçc';
            }
        }


        // --- H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN GIAO DI·ªÜN ---

        function showMessage(text, isError = false) {
            const messageBox = document.getElementById('messageBox');
            const messageTextSpan = document.getElementById('messageText').querySelector('span');
            const messageIcon = document.getElementById('messageText').querySelector('i');

            if (!messageBox || !messageTextSpan || !messageIcon) return;

            messageTextSpan.textContent = text;
            messageBox.className = 'mt-4 p-4 text-sm rounded-xl border';
            messageBox.classList.remove('hidden');

            if (isError) {
                messageBox.classList.add('border-red-300', 'bg-red-50', 'text-red-700');
                messageIcon.className = 'fas fa-exclamation-triangle mr-2';
            } else {
                messageBox.classList.add('border-green-300', 'bg-green-50', 'text-green-700');
                messageIcon.className = 'fas fa-check-circle mr-2';
            }

            if (!isError) {
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }
        }

        function handleConversion() {
            try {
                const inputElement = document.getElementById('numberInput');
                const resultBox = document.getElementById('resultBox');
                const romajiOutput = document.getElementById('romajiOutput');
                const hiraganaOutput = document.getElementById('hiraganaOutput');
                const kanjiOutput = document.getElementById('kanjiOutput');

                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }

                const rawInput = inputElement.value.trim();
                document.getElementById('messageBox').classList.add('hidden');
                resultBox.classList.add('hidden');

                // X√≥a k·∫øt qu·∫£ c≈©
                romajiOutput.textContent = '';
                hiraganaOutput.textContent = '';
                kanjiOutput.textContent = '';


                if (!rawInput) {
                    showMessage("Vui l√≤ng nh·∫≠p m·ªôt s·ªë.", true);
                    return;
                }

                const number = parseInt(rawInput, 10);

                if (isNaN(number) || number < 0 || number > MAX_NUMBER_LIMIT) {
                    showMessage(`S·ªë ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng v√† n·∫±m trong ph·∫°m vi t·ª´ 0 ƒë·∫øn ${MAX_NUMBER_LIMIT.toLocaleString('en-US')}.`, true);
                    return;
                }

                const romajiResult = convertNumberToRomaji(number);
                const hiraganaResult = romajiToKana(romajiResult);
                const kanjiResult = romajiToKanji(romajiResult);

                // Hi·ªÉn th·ªã k·∫øt qu·∫£
                romajiOutput.textContent = romajiResult.toUpperCase(); // In hoa Romaji cho d·ªÖ nh√¨n
                hiraganaOutput.textContent = hiraganaResult;
                kanjiOutput.textContent = kanjiResult;

                resultBox.classList.remove('hidden');
                document.getElementById('messageBox').classList.add('hidden');

            } catch (error) {
                console.error("L·ªói trong qu√° tr√¨nh chuy·ªÉn ƒë·ªïi:", error);
                showMessage("ƒê√£ x·∫£y ra l·ªói h·ªá th·ªëng trong qu√° tr√¨nh chuy·ªÉn ƒë·ªïi. Vui l√≤ng ki·ªÉm tra Console.", true);
            }
        }

        function copyResult(elementId) {
            const resultOutput = document.getElementById(elementId);
            const textToCopy = resultOutput.textContent;

            if (textToCopy) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showMessage(`ƒê√£ sao ch√©p k·∫øt qu·∫£ ${elementId.replace('Output', '')} v√†o clipboard!`, false);
                }).catch(err => {
                    console.error('Kh√¥ng th·ªÉ sao ch√©p:', err);
                    showMessage("L·ªói: Kh√¥ng th·ªÉ sao ch√©p k·∫øt qu·∫£. Vui l√≤ng th·ª≠ th·ªß c√¥ng.", true);
                });
            } else {
                showMessage("Kh√¥ng c√≥ k·∫øt qu·∫£ ƒë·ªÉ sao ch√©p.", true);
            }
        }

        function updateSliderValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(valueId);
            if (slider && valueSpan) {
                valueSpan.textContent = slider.value;
            }
        }


        // --- KH·ªûI T·∫†O V√Ä G√ÅN S·ª∞ KI·ªÜN ---

        document.addEventListener('DOMContentLoaded', () => {
            const convertButton = document.getElementById('convertButton');
            const numberInput = document.getElementById('numberInput');
            const copyButton = document.getElementById('copyRomajiButton'); // N√∫t copy Romaji
            const speakerButton = document.getElementById('speakerButton');
            const voiceSelect = document.getElementById('voiceSelect');
            const rateInput = document.getElementById('rateInput');
            const pitchInput = document.getElementById('pitchInput');

            convertButton.addEventListener('click', handleConversion);
            numberInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleConversion();
                }
            });

            // G√°n s·ª± ki·ªán cho n√∫t Copy Romaji
            copyButton.addEventListener('click', () => copyResult('romajiOutput'));
            speakerButton.addEventListener('click', speakRomaji);

            voiceSelect.addEventListener('change', (event) => {
                selectedVoiceIndex = parseInt(event.target.value, 10);
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
            });

            rateInput.addEventListener('input', () => updateSliderValue('rateInput', 'rateValue'));
            pitchInput.addEventListener('input', () => updateSliderValue('pitchInput', 'pitchValue'));

            populateVoiceList();

            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = populateVoiceList;
            }
        });
    </script>
</body>

</html>
